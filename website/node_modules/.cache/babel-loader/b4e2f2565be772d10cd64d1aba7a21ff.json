{"ast":null,"code":"import _slicedToArray from\"/Users/ssakhilesha/Documents/GitHub/Masters-BDA-project/website/covid19/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{API_DOMAIN,STATE_CODES_ARRAY,STATE_CODES,STATE_NAMES,UNASSIGNED_STATE_CODE,UNKNOWN_DISTRICT_KEY}from'../constants';import produce from'immer';import{memo,useState,useEffect,useMemo,useCallback,useRef}from'react';import*as Icon from'react-feather';import{useTranslation}from'react-i18next';import{Link}from'react-router-dom';import{useDebounce,useKeyPressEvent,useUpdateEffect}from'react-use';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var suggestions=['Madurai','Karnataka','Ladakh','Mumbai','Andhra Pradesh','Alappuzha'];var districtSuggestions=['Madurai','Ganjam','Alappuzha','Mumbai','Chennai'];var stateSuggestions=['Andhra Pradesh','Karnataka','Gujarat','West Bengal','Ladakh'];function Search(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),searchValue=_useState2[0],setSearchValue=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),expand=_useState4[0],setExpand=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),results=_useState6[0],setResults=_useState6[1];var searchInput=useRef(null);var _useTranslation=useTranslation(),t=_useTranslation.t;var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),engine=_useState8[0],setEngine=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),districtEngine=_useState10[0],setDistrictEngine=_useState10[1];useUpdateEffect(function(){import('corejs-typeahead').then(function(Bloodhound){setEngine(// eslint-disable-next-line\nnew Bloodhound.default({initialize:true,local:STATE_CODES_ARRAY.filter(function(_ref){var code=_ref.code;return code!==UNASSIGNED_STATE_CODE;}),queryTokenizer:Bloodhound.default.tokenizers.whitespace,datumTokenizer:Bloodhound.default.tokenizers.obj.whitespace('name')}));setDistrictEngine(// eslint-disable-next-line\nnew Bloodhound.default({initialize:true,limit:5,queryTokenizer:Bloodhound.default.tokenizers.whitespace,datumTokenizer:Bloodhound.default.tokenizers.obj.whitespace('district'),indexRemote:true,remote:{url:\"\".concat(API_DOMAIN,\"/state_district_wise.json\"),transform:function transform(response){var districts=[];Object.keys(response).filter(function(stateName){return stateName!=='State Unassigned';}).map(function(stateName){var districtData=response[stateName].districtData;Object.keys(districtData).filter(function(districtName){return districtName!==UNKNOWN_DISTRICT_KEY;}).map(function(districtName){return districts.push({district:districtName,state:stateName});});return null;});return districts;}}}));});},[expand]);var handleSearch=useCallback(function(searchInput){if(!engine)return null;var results=[];var sync=function sync(datums){datums.map(function(result,index){var stateObj={name:result.name,type:'state',route:result.code};results.push(stateObj);return null;});};var districtSync=function districtSync(datums){datums.slice(0,3).map(function(result,index){var districtObj={name:result.district,type:'district',route:STATE_CODES[result.state]};results.push(districtObj);return null;});setResults([].concat(results));};engine.search(searchInput,sync);districtEngine.search(searchInput,districtSync);},[districtEngine,engine]);useDebounce(function(){if(searchValue){handleSearch(searchValue);}else{setResults(produce(results,function(draftResults){draftResults.splice(0);}));}},100,[searchValue]);function setNativeValue(element,value){var valueSetter=Object.getOwnPropertyDescriptor(element,'value').set;var prototype=Object.getPrototypeOf(element);var prototypeValueSetter=Object.getOwnPropertyDescriptor(prototype,'value').set;if(valueSetter&&valueSetter!==prototypeValueSetter){prototypeValueSetter.call(element,value);}else{valueSetter.call(element,value);}}var fillPlaceholder=useCallback(function(target,index,cursorPosition,callback){if(expand){target.textContent='';return true;}var text=t(suggestions[index]);var placeholder=target.textContent;target.classList.remove('disappear');target.textContent=placeholder+text[cursorPosition];if(cursorPosition<text.length-1){setTimeout(function(){fillPlaceholder(target,index,cursorPosition+1,callback);},200);return true;}callback();},[expand,t]);var clearPlaceholder=useCallback(function(target,callback){var placeholder=target.textContent;target.classList.add('disappear');if(placeholder.length>0){setTimeout(function(){target.textContent='';clearPlaceholder(target,callback);},1000);return true;}callback();},[]);var loopThroughSuggestions=useCallback(function(target,index){if(expand){target.textContent='';return true;}fillPlaceholder(target,index,0,function(){setTimeout(function(){clearPlaceholder(target,function(){loopThroughSuggestions(target,(index+1)%suggestions.length);});},2000);});},[clearPlaceholder,expand,fillPlaceholder]);useEffect(function(){if(!expand){var targetInput=document.getElementsByClassName('search-placeholder')[0];if(targetInput){loopThroughSuggestions(targetInput,0);}}},[expand,loopThroughSuggestions]);var trail=useMemo(function(){var styles=[];[0,0,0].map(function(element,index){styles.push({animationDelay:\"\".concat(index*250,\"ms\")});return null;});return styles;},[]);var handleClose=useCallback(function(){setSearchValue('');setResults([]);},[]);var handleChange=useCallback(function(event){setSearchValue(event.target.value);},[]);useKeyPressEvent('/',function(){searchInput.current.focus();});useKeyPressEvent('Escape',function(){handleClose();searchInput.current.blur();});return/*#__PURE__*/_jsxs(\"div\",{className:\"Search\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"fadeInUp\",style:trail[0],children:t('Search your district or state')}),/*#__PURE__*/_jsx(\"div\",{className:\"line fadeInUp\",style:trail[1]}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-input-wrapper fadeInUp\",style:trail[2],children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchValue,ref:searchInput,onFocus:setExpand.bind(this,true),onBlur:setExpand.bind(this,false),onChange:handleChange}),!expand&&searchValue===''&&/*#__PURE__*/_jsx(\"span\",{className:\"search-placeholder\"}),/*#__PURE__*/_jsx(\"div\",{className:\"search-button\",children:/*#__PURE__*/_jsx(Icon.Search,{})}),searchValue.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"close-button\",onClick:handleClose,children:/*#__PURE__*/_jsx(Icon.X,{})})]}),results.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"results\",children:results.map(function(result,index){return/*#__PURE__*/_jsx(Link,{to:\"state/\".concat(result.route),children:/*#__PURE__*/_jsxs(\"div\",{className:\"result\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"result-left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"result-name\",children:[\"\".concat(result.name),result.type==='district'&&\", \".concat(STATE_NAMES[result.route])]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"result-type\",children:[/*#__PURE__*/_jsx(\"span\",{children:[result.route]}),/*#__PURE__*/_jsx(Icon.ArrowRightCircle,{size:14})]})]})},index);})}),expand&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"expanded\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"expanded-left\",children:[/*#__PURE__*/_jsx(\"h3\",{children:t('District')}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestions\",children:districtSuggestions.map(function(suggestion,index){return/*#__PURE__*/_jsxs(\"div\",{className:\"suggestion\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"-\"}),/*#__PURE__*/_jsx(\"h4\",{onMouseDown:function onMouseDown(event){event.preventDefault();setNativeValue(searchInput.current,suggestion);searchInput.current.dispatchEvent(new Event('input',{bubbles:true}));},children:t(suggestion)})]},index);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"expanded-right\",children:[/*#__PURE__*/_jsx(\"h3\",{children:t('State/UT')}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestions\",children:stateSuggestions.map(function(suggestion,index){return/*#__PURE__*/_jsxs(\"div\",{className:\"suggestion\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"-\"}),/*#__PURE__*/_jsx(\"h4\",{onMouseDown:function onMouseDown(event){event.preventDefault();setNativeValue(searchInput.current,suggestion);searchInput.current.dispatchEvent(new Event('input',{bubbles:true}));},children:t(suggestion)})]},index);})})]})]})})]});}var isEqual=function isEqual(){return true;};export default/*#__PURE__*/memo(Search,isEqual);","map":{"version":3,"sources":["/Users/ssakhilesha/Documents/GitHub/Masters-BDA-project/website/covid19/src/components/Search.js"],"names":["API_DOMAIN","STATE_CODES_ARRAY","STATE_CODES","STATE_NAMES","UNASSIGNED_STATE_CODE","UNKNOWN_DISTRICT_KEY","produce","memo","useState","useEffect","useMemo","useCallback","useRef","Icon","useTranslation","Link","useDebounce","useKeyPressEvent","useUpdateEffect","suggestions","districtSuggestions","stateSuggestions","Search","searchValue","setSearchValue","expand","setExpand","results","setResults","searchInput","t","engine","setEngine","districtEngine","setDistrictEngine","then","Bloodhound","default","initialize","local","filter","code","queryTokenizer","tokenizers","whitespace","datumTokenizer","obj","limit","indexRemote","remote","url","transform","response","districts","Object","keys","stateName","map","districtData","districtName","push","district","state","handleSearch","sync","datums","result","index","stateObj","name","type","route","districtSync","slice","districtObj","search","draftResults","splice","setNativeValue","element","value","valueSetter","getOwnPropertyDescriptor","set","prototype","getPrototypeOf","prototypeValueSetter","call","fillPlaceholder","target","cursorPosition","callback","textContent","text","placeholder","classList","remove","length","setTimeout","clearPlaceholder","add","loopThroughSuggestions","targetInput","document","getElementsByClassName","trail","styles","animationDelay","handleClose","handleChange","event","current","focus","blur","bind","suggestion","preventDefault","dispatchEvent","Event","bubbles","isEqual"],"mappings":"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","sourcesContent":["import {\n  API_DOMAIN,\n  STATE_CODES_ARRAY,\n  STATE_CODES,\n  STATE_NAMES,\n  UNASSIGNED_STATE_CODE,\n  UNKNOWN_DISTRICT_KEY,\n} from '../constants';\n\nimport produce from 'immer';\nimport {memo, useState, useEffect, useMemo, useCallback, useRef} from 'react';\nimport * as Icon from 'react-feather';\nimport {useTranslation} from 'react-i18next';\nimport {Link} from 'react-router-dom';\nimport {useDebounce, useKeyPressEvent, useUpdateEffect} from 'react-use';\n\nconst suggestions = [\n  'Madurai',\n  'Karnataka',\n  'Ladakh',\n  'Mumbai',\n  'Andhra Pradesh',\n  'Alappuzha',\n];\n\nconst districtSuggestions = [\n  'Madurai',\n  'Ganjam',\n  'Alappuzha',\n  'Mumbai',\n  'Chennai',\n];\n\nconst stateSuggestions = [\n  'Andhra Pradesh',\n  'Karnataka',\n  'Gujarat',\n  'West Bengal',\n  'Ladakh',\n];\n\nfunction Search() {\n  const [searchValue, setSearchValue] = useState('');\n  const [expand, setExpand] = useState(false);\n  const [results, setResults] = useState([]);\n  const searchInput = useRef(null);\n  const {t} = useTranslation();\n\n  const [engine, setEngine] = useState(null);\n  const [districtEngine, setDistrictEngine] = useState(null);\n\n  useUpdateEffect(() => {\n    import('corejs-typeahead').then((Bloodhound) => {\n      setEngine(\n        // eslint-disable-next-line\n        new Bloodhound.default({\n          initialize: true,\n          local: STATE_CODES_ARRAY.filter(\n            ({code}) => code !== UNASSIGNED_STATE_CODE\n          ),\n          queryTokenizer: Bloodhound.default.tokenizers.whitespace,\n          datumTokenizer: Bloodhound.default.tokenizers.obj.whitespace('name'),\n        })\n      );\n\n      setDistrictEngine(\n        // eslint-disable-next-line\n        new Bloodhound.default({\n          initialize: true,\n          limit: 5,\n          queryTokenizer: Bloodhound.default.tokenizers.whitespace,\n          datumTokenizer:\n            Bloodhound.default.tokenizers.obj.whitespace('district'),\n          indexRemote: true,\n          remote: {\n            url: `${API_DOMAIN}/state_district_wise.json`,\n            transform: function (response) {\n              const districts = [];\n              Object.keys(response)\n                .filter((stateName) => stateName !== 'State Unassigned')\n                .map((stateName) => {\n                  const districtData = response[stateName].districtData;\n                  Object.keys(districtData)\n                    .filter(\n                      (districtName) => districtName !== UNKNOWN_DISTRICT_KEY\n                    )\n                    .map((districtName) => {\n                      return districts.push({\n                        district: districtName,\n                        state: stateName,\n                      });\n                    });\n                  return null;\n                });\n              return districts;\n            },\n          },\n        })\n      );\n    });\n  }, [expand]);\n\n  const handleSearch = useCallback(\n    (searchInput) => {\n      if (!engine) return null;\n      const results = [];\n\n      const sync = (datums) => {\n        datums.map((result, index) => {\n          const stateObj = {\n            name: result.name,\n            type: 'state',\n            route: result.code,\n          };\n          results.push(stateObj);\n          return null;\n        });\n      };\n\n      const districtSync = (datums) => {\n        datums.slice(0, 3).map((result, index) => {\n          const districtObj = {\n            name: result.district,\n            type: 'district',\n            route: STATE_CODES[result.state],\n          };\n          results.push(districtObj);\n          return null;\n        });\n\n        setResults([...results]);\n      };\n\n      engine.search(searchInput, sync);\n      districtEngine.search(searchInput, districtSync);\n    },\n    [districtEngine, engine]\n  );\n\n  useDebounce(\n    () => {\n      if (searchValue) {\n        handleSearch(searchValue);\n      } else {\n        setResults(\n          produce(results, (draftResults) => {\n            draftResults.splice(0);\n          })\n        );\n      }\n    },\n    100,\n    [searchValue]\n  );\n\n  function setNativeValue(element, value) {\n    const valueSetter = Object.getOwnPropertyDescriptor(element, 'value').set;\n    const prototype = Object.getPrototypeOf(element);\n    const prototypeValueSetter = Object.getOwnPropertyDescriptor(\n      prototype,\n      'value'\n    ).set;\n\n    if (valueSetter && valueSetter !== prototypeValueSetter) {\n      prototypeValueSetter.call(element, value);\n    } else {\n      valueSetter.call(element, value);\n    }\n  }\n\n  const fillPlaceholder = useCallback(\n    (target, index, cursorPosition, callback) => {\n      if (expand) {\n        target.textContent = '';\n        return true;\n      }\n      const text = t(suggestions[index]);\n      const placeholder = target.textContent;\n      target.classList.remove('disappear');\n      target.textContent = placeholder + text[cursorPosition];\n      if (cursorPosition < text.length - 1) {\n        setTimeout(function () {\n          fillPlaceholder(target, index, cursorPosition + 1, callback);\n        }, 200);\n        return true;\n      }\n      callback();\n    },\n    [expand, t]\n  );\n\n  const clearPlaceholder = useCallback((target, callback) => {\n    const placeholder = target.textContent;\n    target.classList.add('disappear');\n    if (placeholder.length > 0) {\n      setTimeout(function () {\n        target.textContent = '';\n        clearPlaceholder(target, callback);\n      }, 1000);\n      return true;\n    }\n    callback();\n  }, []);\n\n  const loopThroughSuggestions = useCallback(\n    (target, index) => {\n      if (expand) {\n        target.textContent = '';\n        return true;\n      }\n\n      fillPlaceholder(target, index, 0, function () {\n        setTimeout(function () {\n          clearPlaceholder(target, function () {\n            loopThroughSuggestions(target, (index + 1) % suggestions.length);\n          });\n        }, 2000);\n      });\n    },\n    [clearPlaceholder, expand, fillPlaceholder]\n  );\n\n  useEffect(() => {\n    if (!expand) {\n      const targetInput =\n        document.getElementsByClassName('search-placeholder')[0];\n\n      if (targetInput) {\n        loopThroughSuggestions(targetInput, 0);\n      }\n    }\n  }, [expand, loopThroughSuggestions]);\n\n  const trail = useMemo(() => {\n    const styles = [];\n\n    [0, 0, 0].map((element, index) => {\n      styles.push({\n        animationDelay: `${index * 250}ms`,\n      });\n      return null;\n    });\n    return styles;\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setSearchValue('');\n    setResults([]);\n  }, []);\n\n  const handleChange = useCallback((event) => {\n    setSearchValue(event.target.value);\n  }, []);\n\n  useKeyPressEvent('/', () => {\n    searchInput.current.focus();\n  });\n\n  useKeyPressEvent('Escape', () => {\n    handleClose();\n    searchInput.current.blur();\n  });\n\n  return (\n    <div className=\"Search\">\n      <label className=\"fadeInUp\" style={trail[0]}>\n        {t('Search your district or state')}\n      </label>\n      <div className=\"line fadeInUp\" style={trail[1]}></div>\n\n      <div className=\"search-input-wrapper fadeInUp\" style={trail[2]}>\n        <input\n          type=\"text\"\n          value={searchValue}\n          ref={searchInput}\n          onFocus={setExpand.bind(this, true)}\n          onBlur={setExpand.bind(this, false)}\n          onChange={handleChange}\n        />\n\n        {!expand && searchValue === '' && (\n          <span className=\"search-placeholder\"></span>\n        )}\n\n        <div className={`search-button`}>\n          <Icon.Search />\n        </div>\n\n        {searchValue.length > 0 && (\n          <div className={`close-button`} onClick={handleClose}>\n            <Icon.X />\n          </div>\n        )}\n      </div>\n\n      {results.length > 0 && (\n        <div className=\"results\">\n          {results.map((result, index) => (\n            <Link key={index} to={`state/${result.route}`}>\n              <div className=\"result\">\n                <div className=\"result-left\">\n                  <div className=\"result-name\">\n                    {`${result.name}`}\n                    {result.type === 'district' &&\n                      `, ${STATE_NAMES[result.route]}`}\n                  </div>\n                </div>\n                <div className=\"result-type\">\n                  <span>{[result.route]}</span>\n                  <Icon.ArrowRightCircle size={14} />\n                </div>\n              </div>\n            </Link>\n          ))}\n        </div>\n      )}\n\n      {expand && (\n        <>\n          <div className=\"expanded\">\n            <div className=\"expanded-left\">\n              <h3>{t('District')}</h3>\n              <div className=\"suggestions\">\n                {districtSuggestions.map((suggestion, index) => (\n                  <div className=\"suggestion\" key={index}>\n                    <div>-</div>\n                    <h4\n                      onMouseDown={(event) => {\n                        event.preventDefault();\n                        setNativeValue(searchInput.current, suggestion);\n                        searchInput.current.dispatchEvent(\n                          new Event('input', {bubbles: true})\n                        );\n                      }}\n                    >\n                      {t(suggestion)}\n                    </h4>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"expanded-right\">\n              <h3>{t('State/UT')}</h3>\n              <div className=\"suggestions\">\n                {stateSuggestions.map((suggestion, index) => (\n                  <div className=\"suggestion\" key={index}>\n                    <div>-</div>\n                    <h4\n                      onMouseDown={(event) => {\n                        event.preventDefault();\n                        setNativeValue(searchInput.current, suggestion);\n                        searchInput.current.dispatchEvent(\n                          new Event('input', {bubbles: true})\n                        );\n                      }}\n                    >\n                      {t(suggestion)}\n                    </h4>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nconst isEqual = () => {\n  return true;\n};\n\nexport default memo(Search, isEqual);\n"]},"metadata":{},"sourceType":"module"}